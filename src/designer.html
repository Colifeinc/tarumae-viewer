<!DOCTYPE html>
<html>
	<head>
		<title>PlanDesigner Editor</title>
		<meta charset="utf-8" />

		<script src="js/lib/jquery-3.2.1.min.js"></script>
		<script src="js/lib/jquery.contextMenu.min.js"></script>

		<!-- Tarumae -->
		<script src="js/utility.js"></script>
		<script src="js/math/matrix.js"></script>
		<script src="js/math/vector.js"></script>
		<script src="js/math/functions.js"></script>
		<script src="js/scene/renderer.js"></script>
		<script src="js/webgl/buffers.js"></script>
		<script src="js/webgl/shader.js"></script>
		<script src="js/webgl/texture.js"></script>
		<script src="js/webgl/cubemap.js"></script>
		<script src="js/webgl/mesh.js"></script>
		<script src="js/debug.js"></script>
		<script src="js/res.js"></script>
		<script src="js/scene/event.js"></script>
		<script src="js/scene/scene.js"></script>
		<script src="js/scene/material.js"></script>
		<script src="js/scene/object.js"></script>
		<script src="js/scene/camera.js"></script>
		<script src="js/scene/animation.js"></script>
		<script src="js/scene/viewer.js"></script>

		<!-- Tarumae Editor -->
		<script src="js/editor/main.js"></script>
		<script src="js/editor/cursor.js"></script>		
		<script src="js/editor/compass.js"></script>
		<script src="js/editor/builtin.js"></script>
		<script src="js/editor/viewer.js"></script>
		<script src="js/editor/select.js"></script>
		<script src="js/editor/action.js"></script>
		<script src="js/editor/objects.js"></script>
		<script src="js/editor/design.js"></script>
		<script src="js/editor/model.js"></script>
		<script src="js/editor/matlib.js"></script>
		<script src="js/editor/load.js"></script>
		<script src="js/editor/save.js"></script>
		<script src="js/editor/undo.js"></script>
		<script src="js/editor/ui.js"></script>
		<script src="js/editor/shader.js"></script>
		<script src="js/editor/debug.js"></script>

		<script src="js/draw/draw.js"></script>
		<script src="js/draw/designer.js"></script>
		<script src="js/draw/demo.js"></script>
		
		<link href="css/tarumae-editor.css" rel="stylesheet" type="text/css" />
		<link href="css/jquery.contextMenu.css" rel="stylesheet" type="text/css" />
	</head>

	<body>
		<div id="header">
			<div id="logo">
				Tarumae
			</div>

			<ul id="main-menu">
				<li id="undo"><img src="images/editor/Undo-24.png"/></li>
				<li id="redo"><img src="images/editor/Redo-24.png"/></li>
				<li class="splitter"></li>
				<li id="topview"><img src="images/editor/TopView-24.png"/></li>
				<li id="focus"><img src="images/editor/Focus-24.png"/></li>
			</ul>
		</div>

		<div id="canvas-container">
		</div>
		
		<script type="text/javascript">
		
			window.addEventListener("load", function() {
				
				TarumaeEditor.BuiltinObjects._s3_foreach(function(name, model) {
					if (model.preview) model.preview = model.preview.replace("images/", "images/editor/");
					if (model.gizmoImage) model.gizmoImage = model.gizmoImage.replace("images/", "images/editor/");
				});

				_renderer = new Tarumae.Renderer({
					debugMode: true,
				});

				var renderer = _renderer;

				// initEditorDebugFunctions(editor);

				// (function() {
				// 	var mainMenu = $("#main-menu");

				// 	// tool strip
				// 	mainMenu.find("#undo").click(function() { editor.undo(); });
				// 	mainMenu.find("#redo").click(function() { editor.redo(); });
				// 	mainMenu.find("#topview").click(function() { editor.toggleTopViewMode(); });
				// 	mainMenu.find("#focus").click(function() { editor.toggleObjectFocus(); });
				// })();

				function setupMenu() {

					$.contextMenu({
						selector: '#canvas-container',

						items: {
							"workarea": {name: "Workspace", callback: function() {
								if (designer.focusArea) {
									designer.focusArea.layout(PlanDesigner.AreaPlanTypes.WorkArea);
								}
							}},
							"confarea": {name: "Conference Area", callback: function() {
								if (designer.focusArea) {
									designer.focusArea.layout(PlanDesigner.AreaPlanTypes.ConferenceArea);
								}
							}},
							"restarea": {name: "Rest Space", callback: function() {
								if (designer.focusArea) {
									designer.focusArea.layout(PlanDesigner.AreaPlanTypes.RestArea);
								}
							}},
							"mealarea": {name: "Meal Area", callback: function() {
								if (designer.focusArea) {
									designer.focusArea.layout(PlanDesigner.AreaPlanTypes.MealArea);
								}
							}},
							"decoarea": {name: "Decorate Area", callback: function() {
								if (designer.focusArea) {
									designer.focusArea.layout(PlanDesigner.AreaPlanTypes.DecorateArea);
								}
							}},
							"reserved": {name: "Reserved", callback: function() {
								if (designer.focusArea) {
									designer.focusArea.layout(PlanDesigner.AreaPlanTypes.ReservedArea);
								}
							}},
							"---": {},
							"wall": {name: "Wall", callback: function() {
								if (designer.focusArea) {
									designer.replaceAreaWith(designer.focusArea, new PlanDesigner.Wall());
								}
							}},
							"none": {name: "None", callback: function() {
								if (designer.focusArea) {
									designer.focusArea.clearLayout();
								}
							}},
						}
					});
				};

				setupMenu();

				var designer = new PlanDesigner(renderer);
				_designer = designer;

				designer.onAreaPlaced = function(area) {
					$("#canvas-container").contextMenu({
						x: renderer.viewer.mouse.position.x,
						y: renderer.viewer.mouse.position.y,
					});
				};

				// var area;
				// area = new PlanDesigner.FixedArea(designer, 300, 200, 300, 300);
				// area.layout(PlanDesigner.AreaPlanTypes.ReservedArea);
				// area.name = 'area1';
				// designer.add(area);

				// area = new PlanDesigner.FixedArea(designer, 500, 300, 300, 300);
				// area.layout(PlanDesigner.AreaPlanTypes.ReservedArea);
				// designer.add(area);

				// designer.demo1();

				renderer.surface.focus();
			
			});

		</script>
	</body>
</html>